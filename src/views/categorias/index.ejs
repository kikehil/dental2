<%- include('../layout', { body: `
<div class="max-w-6xl mx-auto">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-800">Gestión de Categorías</h2>
    <a href="/configuracion/categorias/crear" class="bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700">
      <i class="fas fa-plus mr-2"></i> Nueva Categoría
    </a>
  </div>

  ${success ? `
  <div class="mb-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
    ${success}
  </div>
  ` : ''}

  ${error ? `
  <div class="mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
    ${error}
  </div>
  ` : ''}

  <div class="bg-white rounded-xl shadow-sm overflow-hidden">
    <table class="w-full">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-4 text-left text-sm font-medium text-gray-600">Nombre</th>
          <th class="px-6 py-4 text-left text-sm font-medium text-gray-600">Descripción</th>
          <th class="px-6 py-4 text-center text-sm font-medium text-gray-600">Color</th>
          <th class="px-6 py-4 text-center text-sm font-medium text-gray-600">Estado</th>
          <th class="px-6 py-4 text-center text-sm font-medium text-gray-600">Acciones</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        ${categorias.length === 0 ? `
        <tr>
          <td colspan="5" class="px-6 py-8 text-center text-gray-500">
            No hay categorías registradas. <a href="/configuracion/categorias/crear" class="text-primary-600 hover:underline">Crear una nueva</a>
          </td>
        </tr>
        ` : categorias.map(c => `
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4">
            <p class="font-medium text-gray-800">${c.nombre}</p>
          </td>
          <td class="px-6 py-4 text-gray-600">
            ${c.descripcion || '-'}
          </td>
          <td class="px-6 py-4 text-center">
            ${c.color ? `<span class="inline-block w-6 h-6 rounded-full border border-gray-300" style="background-color: ${c.color}"></span>` : '-'}
          </td>
          <td class="px-6 py-4 text-center">
            ${c.activo ? '<span class="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs">Activa</span>' : '<span class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs">Inactiva</span>'}
          </td>
          <td class="px-6 py-4 text-center">
            <div class="flex justify-center gap-2">
              <a href="/configuracion/categorias/editar/${c.id}" class="text-primary-600 hover:text-primary-800" title="Editar">
                <i class="fas fa-edit"></i>
              </a>
              <button onclick="eliminarCategoria(${c.id}, '${c.nombre}')" class="text-red-600 hover:text-red-800" title="Eliminar">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
        `).join('')}
      </tbody>
    </table>
  </div>
</div>

<script>
function eliminarCategoria(id, nombre) {
  if (!confirm('¿Estás seguro de eliminar la categoría "' + nombre + '"?\n\nNota: No se puede eliminar si tiene servicios asociados.')) {
    return;
  }

  fetch('/configuracion/categorias/' + id, {
    method: 'DELETE',
    headers: { 'Content-Type': 'application/json' }
  })
  .then(function(response) { return response.json(); })
  .then(function(result) {
    if (result.success) {
      window.location.href = '/configuracion/categorias?success=' + encodeURIComponent(result.message);
    } else {
      alert('Error: ' + (result.error || 'No se pudo eliminar la categoría'));
    }
  })
  .catch(function(error) {
    console.error('Error:', error);
    alert('Error al eliminar la categoría');
  });
}
</script>
` }) %>




