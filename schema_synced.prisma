generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id                Int                @id @default(autoincrement())
  email             String             @unique
  password          String
  nombre            String
  rol               String             @default("recepcionista")
  activo            Boolean            @default(true)
  doctorId          Int?               @unique
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  abonosTratamiento AbonoTratamiento[]
  cortesCaja        CorteCaja[]
  gastos            Gasto[]
  pagosLaboratorio  PagoLaboratorio[]
  permisos          PermisoUsuario[]
  usosMateriales    UsoMaterial[]
  doctor            Doctor?            @relation(fields: [doctorId], references: [id])
  vaultMovimientos  VaultMovimiento[]

  @@map("usuarios")
}

model Modulo {
  id          Int              @id @default(autoincrement())
  nombre      String           @unique
  descripcion String?
  ruta        String?
  icono       String?
  activo      Boolean          @default(true)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  permisos    PermisoUsuario[]

  @@map("modulos")
}

model PermisoUsuario {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  moduloId  Int
  acceso    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  modulo    Modulo   @relation(fields: [moduloId], references: [id], onDelete: Cascade)
  usuario   Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, moduloId])
  @@index([moduloId], map: "permisos_usuarios_moduloId_fkey")
  @@map("permisos_usuarios")
}

model Doctor {
  id                   Int                   @id @default(autoincrement())
  nombre               String
  apellido             String
  especialidad         String
  telefono             String?
  email                String?               @unique
  color                String                @default("#3b82f6")
  activo               Boolean               @default(true)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  citas                Cita[]
  consultas            Consulta[]
  horarios             HorarioDoctor[]
  serviciosLaboratorio ServicioLaboratorio[]
  tratamientosPlazo    TratamientoPlazo[]
  usosMateriales       UsoMaterial[]
  usuario              Usuario?
  ventas               Venta[]

  @@map("doctores")
}

model HorarioDoctor {
  id         Int     @id @default(autoincrement())
  doctorId   Int
  diaSemana  Int
  horaInicio String
  horaFin    String
  activo     Boolean @default(true)
  doctor     Doctor  @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@index([doctorId], map: "horarios_doctores_doctorId_fkey")
  @@map("horarios_doctores")
}

model Paciente {
  id                   Int                   @id @default(autoincrement())
  nombre               String
  apellido             String
  fechaNacimiento      DateTime?
  genero               String?
  telefono             String?
  email                String?
  direccion            String?
  ocupacion            String?
  contactoEmergencia   String?
  telefonoEmergencia   String?
  notas                String?               @db.Text
  activo               Boolean               @default(true)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  antecedentes         AntecedenteMedico?
  archivos             ArchivoPaciente[]
  citas                Cita[]
  consultas            Consulta[]
  gastos               Gasto[]
  serviciosLaboratorio ServicioLaboratorio[]
  tratamientosPlazo    TratamientoPlazo[]
  usosMateriales       UsoMaterial[]
  ventas               Venta[]

  @@map("pacientes")
}

model AntecedenteMedico {
  id              Int      @id @default(autoincrement())
  pacienteId      Int      @unique
  alergias        String?  @db.Text
  enfermedades    String?  @db.Text
  medicamentos    String?  @db.Text
  cirugiasPrevias String?  @db.Text
  antecedentesFam String?  @db.Text
  notasMedicas    String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  paciente        Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade)

  @@map("antecedentes_medicos")
}

model Consultorio {
  id        Int      @id @default(autoincrement())
  nombre    String
  ubicacion String?
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  citas     Cita[]

  @@map("consultorios")
}

model Cita {
  id            Int          @id @default(autoincrement())
  pacienteId    Int
  doctorId      Int
  consultorioId Int?
  fecha         DateTime
  horaInicio    String
  horaFin       String
  motivo        String?      @db.Text
  estado        String       @default("programada")
  notas         String?      @db.Text
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  consultorio   Consultorio? @relation(fields: [consultorioId], references: [id])
  doctor        Doctor       @relation(fields: [doctorId], references: [id])
  paciente      Paciente     @relation(fields: [pacienteId], references: [id])

  @@index([consultorioId], map: "citas_consultorioId_fkey")
  @@index([doctorId], map: "citas_doctorId_fkey")
  @@index([pacienteId], map: "citas_pacienteId_fkey")
  @@map("citas")
}

model Consulta {
  id             Int       @id @default(autoincrement())
  pacienteId     Int
  doctorId       Int
  fecha          DateTime  @default(now())
  motivoConsulta String?   @db.Text
  diagnostico    String?   @db.Text
  tratamiento    String?   @db.Text
  observaciones  String?   @db.Text
  proximaCita    DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  doctor         Doctor    @relation(fields: [doctorId], references: [id])
  paciente       Paciente  @relation(fields: [pacienteId], references: [id])

  @@index([doctorId], map: "consultas_doctorId_fkey")
  @@index([pacienteId], map: "consultas_pacienteId_fkey")
  @@map("consultas")
}

model ArchivoPaciente {
  id          Int      @id @default(autoincrement())
  pacienteId  Int
  nombre      String
  tipo        String
  ruta        String
  descripcion String?
  createdAt   DateTime @default(now())
  paciente    Paciente @relation(fields: [pacienteId], references: [id], onDelete: Cascade)

  @@index([pacienteId], map: "archivos_pacientes_pacienteId_fkey")
  @@map("archivos_pacientes")
}

model Categoria {
  id          Int        @id @default(autoincrement())
  nombre      String     @unique
  descripcion String?    @db.Text
  color       String?
  activo      Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  servicios   Servicio[]

  @@map("categorias")
}

model Servicio {
  id                   Int                   @id @default(autoincrement())
  nombre               String
  descripcion          String?               @db.Text
  precio               Decimal               @db.Decimal(10, 2)
  duracion             Int                   @default(30)
  activo               Boolean               @default(true)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  categoriaId          Int?
  categoria            Categoria?            @relation(fields: [categoriaId], references: [id])
  serviciosLaboratorio ServicioLaboratorio[]
  tratamientosPlazo    TratamientoPlazo[]
  items                VentaItem[]

  @@index([categoriaId], map: "servicios_categoriaId_fkey")
  @@map("servicios")
}

model Producto {
  id             Int         @id @default(autoincrement())
  nombre         String
  descripcion    String?     @db.Text
  precio         Decimal     @db.Decimal(10, 2)
  costo          Decimal?    @db.Decimal(10, 2)
  stock          Int         @default(0)
  stockMinimo    Int         @default(5)
  categoria      String?
  activo         Boolean     @default(true)
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  fechaCaducidad DateTime?
  items          VentaItem[]

  @@map("productos")
}

model Material {
  id             Int           @id @default(autoincrement())
  nombre         String
  descripcion    String?       @db.Text
  costo          Decimal?      @db.Decimal(10, 2)
  stock          Int           @default(0)
  stockMinimo    Int           @default(5)
  fechaCaducidad DateTime?
  categoria      String?
  activo         Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  usos           UsoMaterial[]

  @@map("materiales")
}

model UsoMaterial {
  id            Int      @id @default(autoincrement())
  materialId    Int
  pacienteId    Int
  doctorId      Int
  tratamientoId Int?
  cantidad      Int      @default(1)
  observaciones String?  @db.Text
  usuarioId     Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  doctor        Doctor   @relation(fields: [doctorId], references: [id])
  material      Material @relation(fields: [materialId], references: [id])
  paciente      Paciente @relation(fields: [pacienteId], references: [id])
  usuario       Usuario? @relation(fields: [usuarioId], references: [id])

  @@index([doctorId], map: "usos_materiales_doctorId_fkey")
  @@index([materialId], map: "usos_materiales_materialId_fkey")
  @@index([pacienteId], map: "usos_materiales_pacienteId_fkey")
  @@index([usuarioId], map: "usos_materiales_usuarioId_fkey")
  @@map("usos_materiales")
}

model Venta {
  id                Int                @id @default(autoincrement())
  folio             String             @unique
  pacienteId        Int?
  doctorId          Int?
  subtotal          Decimal            @db.Decimal(10, 2)
  descuento         Decimal            @default(0.00) @db.Decimal(10, 2)
  monto             Decimal            @db.Decimal(10, 2)
  metodoPago        String             @default("efectivo")
  banco             String?
  moneda            String             @default("MXN")
  estado            String             @default("completada")
  notas             String?            @db.Text
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  abonosTratamiento AbonoTratamiento[]
  items             VentaItem[]
  doctor            Doctor?            @relation(fields: [doctorId], references: [id])
  paciente          Paciente?          @relation(fields: [pacienteId], references: [id])

  @@index([doctorId])
  @@index([pacienteId], map: "ventas_pacienteId_fkey")
  @@map("ventas")
}

model VentaItem {
  id         Int       @id @default(autoincrement())
  ventaId    Int
  tipo       String
  servicioId Int?
  productoId Int?
  cantidad   Int       @default(1)
  precioUnit Decimal   @db.Decimal(10, 2)
  subtotal   Decimal   @db.Decimal(10, 2)
  producto   Producto? @relation(fields: [productoId], references: [id])
  servicio   Servicio? @relation(fields: [servicioId], references: [id])
  venta      Venta     @relation(fields: [ventaId], references: [id], onDelete: Cascade)

  @@index([productoId], map: "venta_items_productoId_fkey")
  @@index([servicioId], map: "venta_items_servicioId_fkey")
  @@index([ventaId], map: "venta_items_ventaId_fkey")
  @@map("venta_items")
}

model CorteCaja {
  id                            Int      @id @default(autoincrement())
  fecha                         DateTime @default(now())
  hora                          String?
  saldoInicialEfectivo          Decimal  @default(0.00) @db.Decimal(10, 2)
  saldoInicialTransferencia     Decimal  @default(0.00) @db.Decimal(10, 2)
  saldoInicial                  Decimal  @db.Decimal(10, 2)
  ventasEfectivo                Decimal  @default(0.00) @db.Decimal(10, 2)
  ventasTarjeta                 Decimal  @default(0.00) @db.Decimal(10, 2)
  ventasTransferencia           Decimal  @default(0.00) @db.Decimal(10, 2)
  ventasTarjetaAzteca           Decimal  @default(0.00) @db.Decimal(10, 2)
  totalVentas                   Decimal  @default(0.00) @db.Decimal(10, 2)
  saldoFinalEfectivo            Decimal  @default(0.00) @db.Decimal(10, 2)
  saldoFinalTransferencia       Decimal  @default(0.00) @db.Decimal(10, 2)
  saldoFinalTransferenciaAzteca Decimal  @default(0.00) @db.Decimal(10, 2)
  saldoFinalTransferenciaBbva   Decimal  @default(0.00) @db.Decimal(10, 2)
  saldoFinalTransferenciaMp     Decimal  @default(0.00) @db.Decimal(10, 2)
  saldoFinal                    Decimal  @db.Decimal(10, 2)
  diferencia                    Decimal  @default(0.00) @db.Decimal(10, 2)
  observaciones                 String?  @db.Text
  usuarioId                     Int?
  createdAt                     DateTime @default(now())
  updatedAt                     DateTime @updatedAt
  saldoInicialTarjetaAzteca     Decimal  @default(0.00) @db.Decimal(10, 2)
  saldoInicialTarjetaBbva       Decimal  @default(0.00) @db.Decimal(10, 2)
  saldoInicialTarjetaMp         Decimal  @default(0.00) @db.Decimal(10, 2)
  ventasTransferenciaAzteca     Decimal  @default(0.00) @db.Decimal(10, 2)
  ventasTransferenciaBbva       Decimal  @default(0.00) @db.Decimal(10, 2)
  ventasTransferenciaMp         Decimal  @default(0.00) @db.Decimal(10, 2)
  saldoFinalTarjetaAzteca       Decimal  @default(0.00) @db.Decimal(10, 2)
  saldoFinalTarjetaBbva         Decimal  @default(0.00) @db.Decimal(10, 2)
  saldoFinalTarjetaMp           Decimal  @default(0.00) @db.Decimal(10, 2)
  ventasTarjetaBbva             Decimal  @default(0.00) @db.Decimal(10, 2)
  ventasTarjetaMp               Decimal  @default(0.00) @db.Decimal(10, 2)
  usuario                       Usuario? @relation(fields: [usuarioId], references: [id])

  @@index([usuarioId], map: "cortes_caja_usuarioId_fkey")
  @@map("cortes_caja")
}

model ConfiguracionCortes {
  id         Int      @id @default(autoincrement())
  horaCorte1 String   @default("14:00")
  horaCorte2 String   @default("18:00")
  activo     Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("configuracion_cortes")
}

model ConfiguracionTipoCambio {
  id         Int      @id @default(autoincrement())
  tipoCambio Decimal  @db.Decimal(10, 4)
  activo     Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("configuracion_tipo_cambio")
}

model ConfiguracionRetiros {
  id                  Int      @id @default(autoincrement())
  montoMaximoEfectivo Decimal  @db.Decimal(10, 2)
  activo              Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@map("configuracion_retiros")
}

model Gasto {
  id            Int          @id @default(autoincrement())
  motivo        String
  monto         Decimal      @db.Decimal(10, 2)
  metodoPago    String       @default("efectivo")
  banco         String?
  observaciones String?      @db.Text
  usuarioId     Int?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  tipo          String       @default("general")
  laboratorioId Int?
  pacienteId    Int?
  laboratorio   Laboratorio? @relation(fields: [laboratorioId], references: [id])
  paciente      Paciente?    @relation(fields: [pacienteId], references: [id])
  usuario       Usuario?     @relation(fields: [usuarioId], references: [id])

  @@index([laboratorioId], map: "gastos_laboratorioId_fkey")
  @@index([pacienteId], map: "gastos_pacienteId_fkey")
  @@index([usuarioId])
  @@map("gastos")
}

model VaultMovimiento {
  id        Int      @id @default(autoincrement())
  tipo      String
  metodo    String
  banco     String?
  monto     Decimal  @db.Decimal(12, 2)
  nota      String?  @db.Text
  usuarioId Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  usuario   Usuario? @relation(fields: [usuarioId], references: [id])

  @@index([usuarioId])
  @@map("vault_movimientos")
}

model TratamientoPlazo {
  id            Int                @id @default(autoincrement())
  pacienteId    Int
  doctorId      Int
  servicioId    Int
  montoTotal    Decimal            @db.Decimal(10, 2)
  montoPagado   Decimal            @default(0.00) @db.Decimal(10, 2)
  montoAdeudado Decimal            @db.Decimal(10, 2)
  estado        String             @default("pendiente")
  notas         String?            @db.Text
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  abonos        AbonoTratamiento[]
  doctor        Doctor             @relation(fields: [doctorId], references: [id])
  paciente      Paciente           @relation(fields: [pacienteId], references: [id])
  servicio      Servicio           @relation(fields: [servicioId], references: [id])

  @@index([doctorId])
  @@index([pacienteId])
  @@index([servicioId])
  @@map("tratamientos_plazo")
}

model AbonoTratamiento {
  id                 Int              @id @default(autoincrement())
  tratamientoPlazoId Int
  monto              Decimal          @db.Decimal(10, 2)
  saldoAnterior      Decimal          @db.Decimal(10, 2)
  saldoNuevo         Decimal          @db.Decimal(10, 2)
  ventaId            Int?
  notas              String?          @db.Text
  usuarioId          Int?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  tratamientoPlazo   TratamientoPlazo @relation(fields: [tratamientoPlazoId], references: [id], onDelete: Cascade)
  usuario            Usuario?         @relation(fields: [usuarioId], references: [id])
  venta              Venta?           @relation(fields: [ventaId], references: [id])

  @@index([tratamientoPlazoId])
  @@index([usuarioId])
  @@index([ventaId])
  @@map("abonos_tratamiento")
}

model Laboratorio {
  id                   Int                   @id @default(autoincrement())
  nombre               String
  contacto             String?
  telefono             String?
  activo               Boolean               @default(true)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  gastos               Gasto[]
  serviciosLaboratorio ServicioLaboratorio[]

  @@map("laboratorios")
}

model ServicioLaboratorio {
  id             Int               @id @default(autoincrement())
  laboratorioId  Int
  servicioId     Int
  pacienteId     Int
  doctorId       Int
  costo          Decimal           @db.Decimal(10, 2)
  montoPagado    Decimal           @default(0.00) @db.Decimal(10, 2)
  saldoPendiente Decimal           @db.Decimal(10, 2)
  estado         String            @default("pendiente")
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  pagos          PagoLaboratorio[]
  doctor         Doctor            @relation(fields: [doctorId], references: [id])
  laboratorio    Laboratorio       @relation(fields: [laboratorioId], references: [id])
  paciente       Paciente          @relation(fields: [pacienteId], references: [id])
  servicio       Servicio          @relation(fields: [servicioId], references: [id])

  @@index([doctorId], map: "servicios_laboratorio_doctorId_fkey")
  @@index([laboratorioId], map: "servicios_laboratorio_laboratorioId_fkey")
  @@index([pacienteId], map: "servicios_laboratorio_pacienteId_fkey")
  @@index([servicioId], map: "servicios_laboratorio_servicioId_fkey")
  @@map("servicios_laboratorio")
}

model PagoLaboratorio {
  id                    Int                 @id @default(autoincrement())
  servicioLaboratorioId Int
  monto                 Decimal             @db.Decimal(10, 2)
  metodoPago            String              @default("efectivo")
  banco                 String?
  observaciones         String?             @db.Text
  usuarioId             Int?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  servicioLaboratorio   ServicioLaboratorio @relation(fields: [servicioLaboratorioId], references: [id], onDelete: Cascade)
  usuario               Usuario?            @relation(fields: [usuarioId], references: [id])

  @@index([servicioLaboratorioId], map: "pagos_laboratorio_servicioLaboratorioId_fkey")
  @@index([usuarioId], map: "pagos_laboratorio_usuarioId_fkey")
  @@map("pagos_laboratorio")
}

model ConceptoPrestamo {
  id          Int      @id @default(autoincrement())
  nombre      String
  descripcion String?  @db.Text
  activo      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt

  @@map("conceptos_prestamos")
}

model Prestamo {
  id         Int      @id @default(autoincrement())
  doctorId   Int
  conceptoId Int
  monto      Decimal  @db.Decimal(10, 2)
  metodoPago String   @default("efectivo")
  banco      String?
  estatus    String   @default("pendiente")
  notas      String?  @db.Text
  usuarioId  Int?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@map("prestamos")
}
