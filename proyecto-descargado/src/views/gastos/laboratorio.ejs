<%- include('../layout', { body: `
<div class="max-w-6xl mx-auto">
  <!-- Pestañas -->
  <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
    <div class="border-b border-gray-200 mb-6">
      <nav class="flex space-x-8">
        <a href="/gastos" class="px-4 py-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
          Gastos Generales
        </a>
        <a href="/gastos/laboratorio" class="px-4 py-2 border-b-2 border-primary-500 text-primary-600 font-medium">
          <i class="fas fa-flask mr-2"></i>Pagos a Laboratorios
        </a>
        <a href="/gastos/prestamos" class="px-4 py-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
          <i class="fas fa-hand-holding-usd mr-2"></i>Préstamos al Personal
        </a>
      </nav>
    </div>
  </div>

  <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
    <div class="flex justify-end items-center mb-6">
      <div class="flex gap-2">
        <a href="/gastos/reporte?fechaInicio=${fechaInicio}&fechaFin=${fechaFin}" target="_blank" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg">
          <i class="fas fa-file-pdf mr-2"></i>Reporte PDF
        </a>
      </div>
    </div>

    ${success ? '<div class="mb-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">' + success + '</div>' : ''}

    ${error ? '<div class="mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">' + error + '</div>' : ''}

    <div class="mb-6">
      <form method="GET" action="/gastos/laboratorio" class="flex gap-2">
        <input type="date" name="fechaInicio" value="${fechaInicio}" class="px-4 py-2 border rounded-lg">
        <input type="date" name="fechaFin" value="${fechaFin}" class="px-4 py-2 border rounded-lg">
        <button type="submit" class="bg-primary-500 hover:bg-primary-600 text-white px-6 py-2 rounded-lg">
          <i class="fas fa-search mr-2"></i>Buscar
        </button>
        <a href="/gastos/laboratorio" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg">
          <i class="fas fa-redo mr-2"></i>Limpiar
        </a>
      </form>
    </div>

    <div class="grid md:grid-cols-4 gap-4 mb-6">
      <div class="bg-red-50 rounded-lg p-4 border-l-4 border-red-500">
        <p class="text-sm text-gray-600 mb-1">Total Pagos</p>
        <p class="text-2xl font-bold text-red-600">${formatCurrency(totalGastos)}</p>
      </div>
      <div class="bg-green-50 rounded-lg p-4 border-l-4 border-green-500">
        <p class="text-sm text-gray-600 mb-1">Efectivo</p>
        <p class="text-xl font-bold text-green-600">${formatCurrency(totalPorMetodo.efectivo)}</p>
      </div>
      <div class="bg-blue-50 rounded-lg p-4 border-l-4 border-blue-500">
        <p class="text-sm text-gray-600 mb-1">Tarjeta</p>
        <p class="text-xl font-bold text-blue-600">${formatCurrency(totalPorMetodo.tarjeta)}</p>
      </div>
      <div class="bg-purple-50 rounded-lg p-4 border-l-4 border-purple-500">
        <p class="text-sm text-gray-600 mb-1">Transferencia</p>
        <p class="text-xl font-bold text-purple-600">${formatCurrency(totalPorMetodo.transferencia)}</p>
      </div>
    </div>

    <div class="space-y-6">
      ${gastosAgrupados && gastosAgrupados.length > 0 ? gastosAgrupados.map(function(dia) {
        return '<div class="bg-white border border-gray-200 rounded-lg overflow-hidden">' +
          '<div class="bg-gray-50 px-6 py-4 border-b border-gray-200">' +
            '<div class="flex justify-between items-center">' +
              '<h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">' +
                '<i class="fas fa-calendar-day text-primary-500"></i>' +
                dia.fechaFormateada +
              '</h3>' +
              '<span class="px-4 py-2 bg-red-100 text-red-700 rounded-lg font-bold">' +
                'Total del día: ' + formatCurrency(dia.total) +
              '</span>' +
            '</div>' +
          '</div>' +
          '<div class="overflow-x-auto">' +
            '<table class="w-full">' +
              '<thead class="bg-gray-50">' +
                '<tr>' +
                  '<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Hora</th>' +
                  '<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Laboratorio</th>' +
                  '<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Paciente</th>' +
                  '<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Monto</th>' +
                  '<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Método de Pago</th>' +
                  '<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Banco</th>' +
                  '<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Usuario</th>' +
                '</tr>' +
              '</thead>' +
              '<tbody class="bg-white divide-y divide-gray-200">' +
                dia.gastos.map(function(gasto) {
                  return '<tr class="hover:bg-gray-50">' +
                    '<td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">' + moment(gasto.createdAt).format('HH:mm') + '</td>' +
                    '<td class="px-4 py-3 text-sm text-gray-900">' + (gasto.laboratorio ? gasto.laboratorio.nombre : '-') + '</td>' +
                    '<td class="px-4 py-3 text-sm text-gray-900">' + (gasto.paciente ? gasto.paciente.nombre + ' ' + gasto.paciente.apellido : '-') + '</td>' +
                    '<td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-red-600">' + formatCurrency(parseFloat(gasto.monto)) + '</td>' +
                    '<td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500 capitalize">' + gasto.metodoPago + '</td>' +
                    '<td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">' + 
                      (gasto.banco ? '<span class="px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium">' + gasto.banco + '</span>' : '-') + 
                    '</td>' +
                    '<td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">' + (gasto.usuario ? gasto.usuario.nombre : 'N/A') + '</td>' +
                  '</tr>';
                }).join('') +
              '</tbody>' +
            '</table>' +
          '</div>' +
        '</div>';
      }).join('') : '<div class="bg-white border border-gray-200 rounded-lg p-8 text-center text-gray-500">No se encontraron pagos a laboratorios para el período seleccionado</div>'}
    </div>
  </div>
</div>
` }) %>



