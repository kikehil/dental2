<%- include('../layout', { body: `
<div class="max-w-2xl mx-auto">
  <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-gray-800">${categoria ? 'Editar Categoría' : 'Nueva Categoría'}</h2>
      <a href="/configuracion/categorias" class="text-gray-500 hover:text-gray-700">
        <i class="fas fa-times text-2xl"></i>
      </a>
    </div>

    <form id="formCategoria" class="space-y-4">
      <input type="hidden" id="categoriaId" name="id" value="${categoria ? categoria.id : ''}">
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Nombre *</label>
        <input type="text" id="categoriaNombre" name="nombre" required 
               value="${categoria ? categoria.nombre : ''}"
               class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Descripción</label>
        <textarea id="categoriaDescripcion" name="descripcion" rows="3"
                  class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent">${categoria ? (categoria.descripcion || '') : ''}</textarea>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Color</label>
        <div class="flex gap-2 items-center">
          <input type="color" id="categoriaColor" name="color" 
                 value="${categoria && categoria.color ? categoria.color : '#3b82f6'}"
                 class="w-16 h-10 border rounded-lg cursor-pointer">
          <input type="text" id="categoriaColorText" 
                 value="${categoria && categoria.color ? categoria.color : '#3b82f6'}"
                 placeholder="#3b82f6"
                 class="flex-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent">
        </div>
        <p class="text-xs text-gray-500 mt-1">Color para identificar la categoría (opcional)</p>
      </div>

      <div class="flex items-center">
        <input type="checkbox" id="categoriaActivo" name="activo" 
               ${categoria ? (categoria.activo ? 'checked' : '') : 'checked'}
               class="mr-2">
        <label for="categoriaActivo" class="text-sm text-gray-700">Activa</label>
      </div>

      <div class="flex gap-2 pt-4">
        <button type="submit" class="flex-1 bg-primary-500 hover:bg-primary-600 text-white px-6 py-3 rounded-lg font-medium">
          <i class="fas fa-save mr-2"></i>Guardar
        </button>
        <a href="/configuracion/categorias" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium">
          Cancelar
        </a>
      </div>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const colorInput = document.getElementById('categoriaColor');
  const colorTextInput = document.getElementById('categoriaColorText');
  
  // Sincronizar color picker con input de texto
  colorInput.addEventListener('input', function() {
    colorTextInput.value = colorInput.value;
  });
  
  colorTextInput.addEventListener('input', function() {
    if (/^#[0-9A-F]{6}$/i.test(colorTextInput.value)) {
      colorInput.value = colorTextInput.value;
    }
  });

  const form = document.getElementById('formCategoria');
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const submitButton = form.querySelector('button[type="submit"]');
    const originalText = submitButton.innerHTML;
    submitButton.disabled = true;
    submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Guardando...';
    
    const formData = new FormData(form);
    const data = {};
    formData.forEach(function(value, key) {
      data[key] = value;
    });
    
    // Convertir activo a boolean
    data.activo = document.getElementById('categoriaActivo').checked;
    
    fetch('/configuracion/categorias', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    })
    .then(function(response) { return response.json(); })
    .then(function(result) {
      if (result.success) {
        window.location.href = '/configuracion/categorias?success=' + encodeURIComponent(result.message);
      } else {
        alert('Error: ' + (result.error || 'Error al guardar la categoría'));
        submitButton.disabled = false;
        submitButton.innerHTML = originalText;
      }
    })
    .catch(function(error) {
      console.error('Error:', error);
      alert('Error al guardar la categoría');
      submitButton.disabled = false;
      submitButton.innerHTML = originalText;
    });
  });
});
</script>
` }) %>




